#/bin/bash -e

PROFILE_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PEBBLE_DIR="$(dirname "$PROFILE_DIR")"
PEBBLE_EXE="$PEBBLE_DIR/pebble"

# Pebble state directory
PEBBLE="$PROFILE_DIR/pebble-state"

echo "Running HTTP API (Unix socket) ..."

PULL_FILE="$PEBBLE/pull-file"

truncate --size=1000M "$PULL_FILE"

while true; do
	time PEBBLE="$PEBBLE" "$PEBBLE_EXE" pull "$PULL_FILE" "$PROFILE_DIR/pull-file"
done

